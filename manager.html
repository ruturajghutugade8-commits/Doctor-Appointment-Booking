<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Manager - Appointments</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    /* Hide delete button by default */
    .delete-btn {
      display: none;
    }
    /* Show delete button only on row hover */
    tr:hover .delete-btn {
      display: inline-block;
    }
  </style>
</head>
<body>
  <!-- Navbar -->
  <nav class="navbar navbar-dark bg-dark">
    <div class="container-fluid">
      <a class="navbar-brand">üè• Hospital Manager Panel</a>
      <button class="btn btn-outline-light d-none" id="logoutBtn">Logout</button>
    </div>
  </nav>

  <!-- Login Section -->
  <div class="container my-5" id="loginSection">
    <div class="row justify-content-center">
      <div class="col-md-5">
        <div class="card shadow p-4">
          <h3 class="text-center mb-3">üîí Admin Login</h3>
          <form id="loginForm">
            <div class="mb-3">
              <label class="form-label">Username</label>
              <input type="text" id="username" class="form-control" required>
            </div>
            <div class="mb-3">
              <label class="form-label">Password</label>
              <input type="password" id="password" class="form-control" required>
              <div class="form-text">Enter the correct admin password</div>
            </div>
            <button type="submit" class="btn btn-dark w-100">Login</button>
          </form>
          <p id="error" class="text-danger mt-3 text-center"></p>
        </div>
      </div>
    </div>
  </div>

  <!-- Appointment Section (Hidden until login) -->
  <div class="container my-5 d-none" id="appointmentSection">
    <h2 class="text-center mb-4">All Appointments</h2>
    <table class="table table-bordered table-hover">
      <thead class="table-dark">
        <tr>
          <th>Doctor</th>
          <th>Patient Name</th>
          <th>Email</th>
          <th>Contact Number</th>
          <th>Date</th>
          <th>Action</th>
        </tr>
      </thead>
      <tbody id="appointmentsTable"></tbody>
    </table>
  </div>

  <script>
    // --- Admin credentials ---
    const ADMIN_USERNAME = "@userruturaj"; 
    const ADMIN_PASSWORD = "nadkaratiky_312005"; 

    const loginSection = document.getElementById("loginSection");
    const appointmentSection = document.getElementById("appointmentSection");
    const logoutBtn = document.getElementById("logoutBtn");

    // If already logged in, show appointment section
    if (sessionStorage.getItem("isAdminLoggedIn") === "true") {
      loginSection.classList.add("d-none");
      appointmentSection.classList.remove("d-none");
      logoutBtn.classList.remove("d-none");
      loadAppointments();
    }

    // Handle login
    document.getElementById("loginForm").addEventListener("submit", function(e) {
      e.preventDefault();
      const username = document.getElementById("username").value.trim();
      const password = document.getElementById("password").value.trim();
      const error = document.getElementById("error");

      if (username === ADMIN_USERNAME && password === ADMIN_PASSWORD) {
        sessionStorage.setItem("isAdminLoggedIn", "true");
        loginSection.classList.add("d-none");
        appointmentSection.classList.remove("d-none");
        logoutBtn.classList.remove("d-none");
        loadAppointments();
      } else {
        error.textContent = "‚ùå Invalid username or password!";
      }
    });

    // Handle logout
    logoutBtn.addEventListener("click", () => {
      sessionStorage.removeItem("isAdminLoggedIn");
      location.reload();
    });

    // Load appointments function
    function loadAppointments() {
      const tableBody = document.getElementById('appointmentsTable');
      const appointments = JSON.parse(localStorage.getItem('appointments')) || [];

      if (appointments.length === 0) {
        tableBody.innerHTML = `<tr><td colspan="5" class="text-center">No Appointments Found</td></tr>`;
      } else {
        tableBody.innerHTML = "";
        appointments.forEach((app, index) => {
          tableBody.innerHTML += `
            <tr>
              <td>${app.doctor}</td>
              <td>${app.name}</td>
              <td>${app.email}</td>
              <td>${app.mob}</td>
              <td>${app.date}</td>
              <td>
                <button class="btn btn-sm btn-danger delete-btn" onclick="deleteAppointment(${index})">üóëÔ∏è Delete</button>
              </td>
            </tr>`;
        });
      }
    }

    // Delete appointment
    function deleteAppointment(index) {
      let appointments = JSON.parse(localStorage.getItem('appointments')) || [];
      appointments.splice(index, 1); // remove selected row
      localStorage.setItem('appointments', JSON.stringify(appointments));
      loadAppointments(); // reload table
    }
  </script>
</body>
</html>
